path: project
name: CFPB Complaints Analytics
cli_version: 1.0.75
includes: []
destinations: []
alerts: []

# Data source configuration
sources:
  - name: duckdb_cfpb
    type: duckdb
    database: ../database/cfpb_complaints.duckdb

# Data models
models:
  # Company performance metrics
  - name: company_metrics
    source: ref(duckdb_cfpb)
    sql: |
      SELECT
        company,
        total_complaints,
        pct_disputed,
        pct_timely,
        avg_days_to_response
      FROM raw_marts.dim_companies
      ORDER BY total_complaints DESC
      LIMIT 20

  # Monthly trends
  - name: monthly_trends
    source: ref(duckdb_cfpb)
    sql: |
      SELECT
        complaint_month_date,
        total_complaints,
        pct_timely,
        pct_disputed,
        avg_days_to_response
      FROM raw_marts.agg_complaints_by_month
      ORDER BY complaint_month_date

  # State distribution
  - name: state_distribution
    source: ref(duckdb_cfpb)
    sql: |
      SELECT
        state,
        total_complaints,
        pct_disputed,
        pct_timely
      FROM raw_marts.dim_states
      ORDER BY total_complaints DESC
      LIMIT 25

# Visualization traces
traces:
  # Company performance bar chart
  - name: company_complaints_bar
    model: ref(company_metrics)
    props:
      type: bar
      x: query(company)
      y: query(total_complaints)
      name: "Complaints"
      marker:
        color: "#3B82F6"

  # Monthly trend line
  - name: monthly_complaints_line
    model: ref(monthly_trends)
    props:
      type: scatter
      mode: lines+markers
      x: query(complaint_month_date)
      y: query(total_complaints)
      name: "Total Complaints"
      line:
        color: "#10B981"
        width: 2

  # Dispute rate trend
  - name: dispute_rate_line
    model: ref(monthly_trends)
    props:
      type: scatter
      mode: lines
      x: query(complaint_month_date)
      y: query(pct_disputed)
      name: "Dispute Rate %"
      yaxis: y2
      line:
        color: "#EF4444"
        width: 2

# Charts
charts:
  # Company performance chart
  - name: company_performance
    traces:
      - ref(company_complaints_bar)
    layout:
      title:
        text: "Top 20 Companies by Complaint Volume"
      xaxis:
        title:
          text: Company
      yaxis:
        title:
          text: Total Complaints

  # Monthly trends chart
  - name: monthly_trends_chart
    traces:
      - ref(monthly_complaints_line)
      - ref(dispute_rate_line)
    layout:
      title:
        text: "Monthly Complaint Trends"
      xaxis:
        title:
          text: Month
      yaxis:
        title:
          text: Total Complaints
      yaxis2:
        title:
          text: Dispute Rate %
        overlaying: y
        side: right

# Dashboards
dashboards:
  # Executive Dashboard
  - name: executive_dashboard
    rows:
      - height: medium
        items:
          - width: 12
            markdown: "# CFPB Complaints Executive Dashboard\nOverview of complaint trends, company performance, and key metrics"

      - height: large
        items:
          - width: 8
            chart: ref(monthly_trends_chart)
          - width: 4
            chart: ref(company_performance)

      - height: large
        items:
          - width: 12
            chart: ref(company_performance)

  # Geographic Analysis Dashboard
  - name: geographic_dashboard
    rows:
      - height: medium
        items:
          - width: 12
            markdown: "# Geographic Analysis\nComplaint distribution across US states"

      - height: large
        items:
          - width: 12
            chart: ref(company_performance)

selectors: []
